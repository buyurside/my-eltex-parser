# Описание
Скрипт создан с целью сборки конфигурации с маршрутизаторов [Eltex ESR-3100](https://eltex-co.ru/catalog/service_gateways/servisnyy_marshrutizator_esr-3100/),\
поскольку до этого были безуспешные попытки подружить их с [oxidized](https://github.com/ytti/oxidized).\
Принимает конфиги в формате yaml.

# Принцип работы
1. Посылаем по ssh команду `show running-config`
2. Парсим вывод, отрезаем голову до начала конфига (`hostname ...`)
3. Проверяем, есть ли файлы в директории для данного хоста, куда собираемся сохранить спаршенный конфиг
4. Если есть файлы в директории, то сверяем последний из них с нашим выводом
5. Если полученный с железки вывод и последний сохраненный конфиг одинаковы, то пропускаем этот хост
6. Если есть изменения (вывод и последний конфиг не одинаковы), сохраняем конфиг

# Переменные
Можно указывать в списке параметров хоста директорию, куда будут складываться конфиги:
### hosts [обязателен]
- Глобальная переменная

Массив словарей, в минимальный состав которых должны входить ключи с именем `ip`.
```yaml
---
hosts:
  - { "ip": 10.123.12.1, "port": 22, "hostname": "ROUTER-1", "dir": "ROUTER-1_confs" }
  - { "ip": 10.123.12.2, "port": 22, "hostname": "ROUTER-2", "dir": "ROUTER-2_confs" }
```
___
#### ip [обязателен]
- Переменная словаря из `hosts`

IPv4 адрес хоста.
```yaml
hosts:
  - { "ip": 10.0.0.1, ... }
```
#### hostname [обязателен]
- Переменная словаря из `hosts`

Хостнейм узла. Если не указан параметр `dir`, то директория,\
в которую в последствии складываются конфиги с хоста, будет называться как `hostname`.\
  Подробнее в секции параметра `dir`.
```yaml
hosts:
  - { ... "hostname": "ROUTER-1", ... }
```
#### port
- Переменная словаря из `hosts`
- Значение по умолчанию - `22`.

Порт ssh сервера, куда будет подключиться скрипт.
```yaml
hosts:
  - { ... "port": 2222, ... }
```
#### dir
- Переменная словаря из `hosts`
- Если данный параметр не указан, то директория,\
  в которую в последствии складываются конфиги с хоста, будет называться как `hostname`.

Относительный путь до директории, куда складываются конфиги с указанного хоста.
```yaml
hosts:
  - { ... "dir": "ROUTER-1", ... }
```
___
### working_dir
- Глобальная переменная

Рабочая директория.\
Абсолютный путь до директории, где скрипт будет создавать директории\
и в них складывать конфиги с соответствующих хостов.
```yaml
working_dir: "/srv/eltex_backups"
```
### delay
- Глобальная переменная

Пауза в секундах между запросами к оборудованию.\
Иными словами - сколько секунд паузы скрипт будет выжидать между проходами по словарю `hosts`.
```yaml
delay: 123
```

# Несколько примеров конфигов:

### Авторизация по ключу (минимальный базовый конфиг)
```yaml
---
hosts:
  - { "ip": 10.123.12.34, "port": 22, "hostname": "ROUTER-1" }
username: "user"
```

### Авторизация по кредам
```yaml
---
hosts:
  - { "ip": 10.123.12.34, "port": 22, "hostname": "ROUTER-1" }
  - { "ip": 10.123.12.35, "port": 22, "hostname": "ROUTER-2", "dir":"ROUTER-2_confs" }
username: "user"
password: "password"
```

# ToDo

- [ ] Реализовать возможность указания только юзернейма либо кредов для каждого хоста в общем списке
- [ ] Добавить логику, когда при пустых `dir` и `hostname` создавалась папка с именем из `ip`
- [ ] Добавить логику, когда скрипт будет работать без указания `ip`, только по `hostname` (через DNS)
